@using System.ComponentModel.DataAnnotations;
@using Document_Management.Utility.Constants
@model Document_Management.Models.FileDocument

@{
    ViewData["Title"] = "Transfer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Transfer Files</h1>
<hr />
<div class="row">
    <div class="col">
    <form asp-action="Transfer">
        @Html.AntiForgeryToken()
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="Id" />
        <div class="form-group mb-3">
            <label asp-for="OriginalFilename" class="form-label"></label>
            <input asp-for="OriginalFilename" class="form-control" disabled readonly />
            <span asp-validation-for="OriginalFilename" class="text-danger"></span>
        </div>
        <div class="form-group mb-3">
            <label asp-for="Company" class="form-label"></label>
            <div class="col">
                <select asp-for="Company" class="form-select" id="companyDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the company --</option>
                    @foreach (var company in Companies.All)
                    {
                        <option value="@company">@company</option>
                    }
                </select>
                <span asp-validation-for="Company" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group mb-3">
            <label asp-for="Year" class="form-label"></label>
            <div class="col">
                <select asp-for="Year" id="yearDropdown" class="form-select" style="width:100%"></select>
                <span asp-validation-for="Year" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group mb-3">
            <label asp-for="Department" class="form-label"></label>
            <div class="col">
                <select asp-for="Department" class="form-select" id="departmentDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the department --</option>
                    @foreach (var department in Departments.All)
                    {
                        <option value="@department">@department</option>
                    }
                </select>
                <span asp-validation-for="Department" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group mb-3">
            <label asp-for="Category" class="form-label"></label>
            <div class="col">
                <select asp-for="Category" class="form-select" id="categoryDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the category --</option>
                    @foreach (var category in Categories.All)
                    {
                        <option value="@category">@category</option>
                    }
                </select>
                <span asp-validation-for="Category" class="text-danger"></span>
            </div>
        </div>
        
        <!--Administration Sub Category Dropdown-->
        <div class="mb-3" id="administrationSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="administrationDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.AdministrationSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>

        <!--Operations Sub Category Dropdown-->
        <div class="mb-3" id="operationsSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="operationsDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.OperationSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>
        
        <!--Finance Sub Category Dropdown-->
        <div class="mb-3" id="financeSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="financeDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.FinanceSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>

        <!--Check Vouchers Sub Category Dropdown-->
        <div class="mb-3" id="checkVoucherSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="checkVoucherDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.CheckVouchersSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>
        
        <!--Payroll Sub Category Dropdown-->
        <div class="mb-3" id="payrollSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="payrollDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.PayrollSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>

        <!--Compliance or Legal Sub Category Dropdown-->
        <div class="mb-3" id="complianceLegalSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="complianceLegalDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.ComplianceOrLegalSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>
        
        <!--Investment Sub Category Dropdown-->
        <div class="mb-3" id="investmentSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="investmentDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.InvestmentsSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>

        <!--Marketing Sub Category Dropdown-->
        <div class="mb-3" id="marketingSubCategories" style="display: none;">
            <label asp-for="SubCategory" class="form-label"></label>
            <div class="col">
                <select name="SubCategory" class="form-select full-width" id="marketingDropdown" style="width:100%">
                    <option value="" selected disabled>-- Select the sub category --</option>
                    @foreach (var subCategory in SubCategories.MarketingSubCategory)
                    {
                        <option value="@subCategory">@subCategory</option>
                    }
                </select>
                <span asp-validation-for="SubCategory" class="text-danger"></span>
            </div>
        </div>
        
        <div class="form-group mb-3">
                <input type="submit" value="Transfer" class="btn btn-secondary" />
                <a asp-action="Index" class="btn btn-primary">Back</a>
        </div>
    </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        const dropdown = document.getElementById('yearDropdown');
        let currentYear = new Date().getFullYear();
        let yearsInPast = 20; // Number of years in the past
        let yearsInFuture = 10; // Number of years in the future

        // Populate the dropdown with years
        for (var i = currentYear - yearsInPast; i <= currentYear + yearsInFuture; i++) {
            var option = document.createElement('option');
            option.value = i;
            option.text = i;

            if (i === currentYear) {
                option.setAttribute('selected', 'selected'); // Set the current year as the default
            }
            dropdown.appendChild(option);
        }
        
        // Set the model value after populating options
        if (@Model.Year !== 0) {
            dropdown.value = @Model.Year;
        }
    </script>
    
    <script>
        $(document).ready(function () {
            var categoryDropdown = $('#categoryDropdown');
            var allSubCategoryContainers = [
                '#administrationSubCategories', 
                '#operationsSubCategories', 
                '#financeSubCategories', 
                '#checkVoucherSubCategories', 
                '#payrollSubCategories', 
                '#complianceLegalSubCategories', 
                '#investmentSubCategories', 
                '#marketingSubCategories'
            ];
            
            var allSubCategoryDropdowns = [
                '#administrationDropdown',
                '#operationsDropdown',
                '#financeDropdown',
                '#checkVoucherDropdown',
                '#payrollDropdown',
                '#complianceLegalDropdown',
                '#investmentDropdown',
                '#marketingDropdown'
            ];
    
            function clearAllSubCategories() {
                // Hide all subcategory containers
                $(allSubCategoryContainers.join(', ')).hide();
                
                // Reset all subcategory dropdowns to default option and clear their values
                allSubCategoryDropdowns.forEach(function(dropdownId) {
                    var $dropdown = $(dropdownId);
                    if ($dropdown.hasClass('select2-hidden-accessible')) {
                        $dropdown.select2('destroy');
                    }
                    $dropdown.prop('selectedIndex', 0).val('');
                });
            }
    
            function toggleSubCategories(value) {
                // Clear all subcategories first
                clearAllSubCategories();
    
                let targetContainer = null;
                let targetDropdown = null;
    
                switch (value) {
                    case "@Categories.Administration":
                        targetContainer = '#administrationSubCategories';
                        targetDropdown = '#administrationDropdown';
                        break;
                    case "@Categories.Operations":
                        targetContainer = '#operationsSubCategories';
                        targetDropdown = '#operationsDropdown';
                        break;
                    case "@Categories.Finance":
                        targetContainer = '#financeSubCategories';
                        targetDropdown = '#financeDropdown';
                        break;
                    case "@Categories.CheckVouchers":
                        targetContainer = '#checkVoucherSubCategories';
                        targetDropdown = '#checkVoucherDropdown';
                        break;
                    case "@Categories.Payroll":
                        targetContainer = '#payrollSubCategories';
                        targetDropdown = '#payrollDropdown';
                        break;
                    case "@Categories.ComplianceLegal":
                        targetContainer = '#complianceLegalSubCategories';
                        targetDropdown = '#complianceLegalDropdown';
                        break;
                    case "@Categories.Investments":
                        targetContainer = '#investmentSubCategories';
                        targetDropdown = '#investmentDropdown';
                        break;
                    case "@Categories.Marketing":
                        targetContainer = '#marketingSubCategories';
                        targetDropdown = '#marketingDropdown';
                        break;
                }
    
                if (targetContainer && targetDropdown) {
                    // Show the target container and initialize select2 on the dropdown
                    $(targetContainer).show();
                    $(targetDropdown).select2();
                }
            }
    
            // Handle category change
            categoryDropdown.on('change', function () {
                toggleSubCategories($(this).val());
            });
            
            // Initial check - only if category has a value
            var initialCategoryValue = categoryDropdown.val();
            if (initialCategoryValue) {
                toggleSubCategories(initialCategoryValue);
            }
        });
    </script>
}