@using Document_Management.Utility.Helper
@model ActivityReportViewModel

@{
ViewData["Title"] = "File Upload Report";
var userName = Model.CurrentUser;
}

<style>
    /* Print styles */
    @@media print {
        /* Hide elements that shouldn't print */
        .no-print {
            display: none !important;
        }

        /* Remove margins and adjust layout */
        body {
            margin: 0;
            padding: 10px;
        }

        /* Optimize table for printing */
        table {
            font-size: 8pt !important;
            width: 100% !important;
            page-break-inside: auto;
        }

        th, td {
            padding: 4px !important;
            font-size: 8pt !important;
            word-wrap: break-word;
        }

        th {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }

        tr {
            page-break-inside: avoid;
            page-break-after: auto;
        }

        thead {
            display: table-header-group;
        }

        /* Adjust header spacing */
        .report-header {
            margin-bottom: 15px;
        }

        .report-header h4 {
            font-size: 12pt;
            margin-bottom: 5px;
        }

        .report-header h5 {
            font-size: 10pt;
            margin-bottom: 10px;
        }

        /* Ensure footer stays at bottom */
        .footer-section {
            margin-top: 15px;
            font-size: 8pt;
            page-break-inside: avoid;
        }

        /* Remove Bootstrap's responsive table wrapper issues */
        .table-responsive {
            overflow: visible !important;
        }

        /* Landscape orientation hint */
        @@page {
            size: landscape;
            margin: 0.5cm;
        }
    }

    /* Screen styles */
    @@media screen {
        .report-container {
            margin: 0 2em;
        }

        .print-hint {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
    }
</style>

<div class="report-container">
    <div class="print-hint no-print">
        <strong>💡 Print Tip:</strong> For best results, set your printer to <strong>Landscape</strong> orientation in the print dialog.
    </div>

    <div class="row mb-3 report-header">
        <div class="col-6">
            <h4>Report Generated by: @userName</h4>
            <h5>Date Range: @Model.DateFrom.ToString("MMM dd, yyyy") to @Model.DateTo.ToString("MMM dd, yyyy")</h5>
        </div>
        <div class="col-6 text-end">
            <button class="btn btn-secondary buttons no-print" onclick="window.print()">Print Report</button>
        </div>
    </div>

    @if (Model.UploadedFiles?.Any() ?? false)
    {
    <div class="table-responsive">
        <table class="table table-bordered table-striped w-100">
            <thead>
            <tr>
                <th style="width: 8%;">Box #</th>
                <th style="width: 15%;">Company</th>
                <th style="width: 6%;">Year</th>
                <th style="width: 13%;">Department</th>
                <th style="width: 12%;">Category</th>
                <th style="width: 12%;">Sub Category</th>
                <th style="width: 8%;">User</th>
                <th style="width: 7%;">Files</th>
                <th style="width: 10%;">Submitted By</th>
                <th style="width: 9%;">Date</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var fileGroup in Model.UploadedFiles)
            {
            <tr>
                <td>@fileGroup.BoxNumber</td>
                <td>@fileGroup.Company</td>
                <td>@fileGroup.Year</td>
                <td>@fileGroup.Department</td>
                <td>@fileGroup.Category</td>
                <td>@fileGroup.SubCategory</td>
                <td>@fileGroup.Username</td>
                <td class="text-center">@fileGroup.FileCount</td>
                <td>@fileGroup.SubmittedBy</td>
                <td style="white-space: nowrap;">@fileGroup.DateSubmitted.ToString("MMM dd, yyyy")</td>
            </tr>
            }
            </tbody>
        </table>
    </div>
    }
    else
    {
    <div class="alert alert-info text-center" role="alert">
        No files uploaded within the specified date range.
    </div>
    }

    <div class="footer-section">
        <p><i>This report was generated on @DateTimeHelper.GetCurrentPhilippineTimeFormatted()</i></p>
    </div>

    <a asp-controller="Report" asp-action="ActivityReportForm" class="btn btn-primary buttons no-print">Back</a>
</div>

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function () {
        window.onafterprint = function () {
            alert('Print completed!');
        };
    });
</script>
}